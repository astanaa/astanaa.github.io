<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World's Education</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: Arial, sans-serif;
            background: url('https://raw.githubusercontent.com/astanaa/Data_Visualization_Project/main/Images/sky%20full%20of%20stars.jpg') center/cover fixed;
            overflow: hidden;
            height: 100vh;
        }

        #landing-page {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: transform 0.8s ease-in-out;
            z-index: 100;
            opacity: 0;
            animation: fadeIn 1.5s ease-in forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        #landing-page.slide-up {
            transform: translateY(-100vh);
        }

        .landing-content {
            max-width: 800px;
            padding: 40px;
            text-align: center;
        }

        .landing-paragraph {
            font-size: clamp(14px, 2.5vw, 20px);
            line-height: 1.8;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 15px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .unesco-link {
            display: block;
            text-align: center;
            margin-bottom: 35px;
            font-size: clamp(13px, 2vw, 16px);
        }

        .unesco-link a {
            color: rgba(95, 179, 246, 0.9);
            text-decoration: underline;
            text-underline-offset: 3px;
            transition: all 0.3s;
        }

        .unesco-link a:hover {
            color: #5fb3f6;
            text-shadow: 0 0 10px rgba(95, 179, 246, 0.5);
        }

        .uncover-btn {
            background: rgba(95, 179, 246, 0.2);
            border: 2px solid rgba(95, 179, 246, 0.6);
            color: #5fb3f6;
            padding: 18px 45px;
            font-size: clamp(16px, 2vw, 20px);
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.4s ease;
            backdrop-filter: blur(10px);
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 0 30px rgba(95, 179, 246, 0.3);
        }

        .uncover-btn:hover {
            background: rgba(95, 179, 246, 0.4);
            border-color: rgba(95, 179, 246, 0.9);
            box-shadow: 0 0 50px rgba(95, 179, 246, 0.6);
            transform: translateY(-3px);
        }

        .uncover-btn:active {
            transform: translateY(-1px);
        }

        #visualization-container {
            width: 100vw;
            height: 100vh;
            position: absolute;
            top: 100vh;
            left: 0;
            transition: transform 0.8s ease-in-out;
        }

        #visualization-container.slide-up {
            transform: translateY(-100vh);
        }

        .fade-top-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 150px;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent);
            z-index: 10;
            pointer-events: none;
        }

        .title {
            position: absolute;
            top: 40px;
            left: 40px;
            z-index: 20;
            font-size: 2em;
            font-weight: 600;
            color: #5fb3f6;
            text-shadow: 0 0 20px rgba(95, 179, 246, 0.4);
        }

        .nav-container {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            display: flex;
            gap: 15px;
            background: rgba(10, 20, 40, 0.8);
            padding: 8px;
            border-radius: 30px;
            border: 1px solid rgba(95, 179, 246, 0.3);
            backdrop-filter: blur(10px);
        }

        .nav-btn {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            padding: 10px 25px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            user-select: none;
        }

        .nav-btn:hover { color: #5fb3f6; background: rgba(95, 179, 246, 0.1); }
        .nav-btn.active { color: #fff; background: rgba(95, 179, 246, 0.3); box-shadow: 0 0 15px rgba(95, 179, 246, 0.3); }

        .search-container {
            position: absolute;
            top: 45px;
            right: 57px;
            z-index: 20;
            width: 280px;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(10, 20, 40, 0.9);
            border: 1px solid rgba(95, 179, 246, 0.3);
            border-radius: 25px;
            color: white;
            font-size: 14px;
            outline: none;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }

        .search-input::placeholder { color: rgba(255, 255, 255, 0.4); }
        .search-input:focus { border-color: rgba(95, 179, 246, 0.8); box-shadow: 0 0 20px rgba(95, 179, 246, 0.3); }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 8px;
            background: rgba(10, 20, 40, 0.95);
            border: 1px solid rgba(95, 179, 246, 0.3);
            border-radius: 12px;
            max-height: 300px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
            display: none;
            z-index: 1000;
        }

        .search-results.show { display: block; }

        .search-result-item {
            padding: 12px 16px;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            border-bottom: 1px solid rgba(95, 179, 246, 0.1);
            transition: all 0.2s;
            font-size: 14px;
        }

        .search-result-item:hover {
            background: rgba(95, 179, 246, 0.2);
            color: #5fb3f6;
            padding-left: 20px;
        }

        #globe-container, #chart-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: transform 0.8s ease-in-out;
        }

        #globe-container.slide-up, #chart-container.slide-up { transform: translateY(-100vh); }

        #globe { cursor: grab; }
        #globe:active { cursor: grabbing; }

        .tooltip {
            position: absolute;
            padding: 10px 15px;
            background: rgba(10, 20, 40, 0.95);
            border: 1px solid rgba(95, 179, 246, 0.3);
            border-radius: 8px;
            color: white;
            font-size: 14px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .tooltip.show { opacity: 1; }
        .tooltip-country { font-weight: 600; color: #5fb3f6; margin-bottom: 3px; }
        .tooltip-score { color: rgba(255, 255, 255, 0.9); font-size: 13px; }

        .pisa-term {
            text-decoration: underline;
            text-decoration-style: dotted;
            text-underline-offset: 3px;
            cursor: help;
            color: #5fb3f6;
            position: relative;
        }

        .pisa-tooltip {
            position: absolute;
            padding: 12px 15px;
            background: rgba(10, 20, 40, 0.98);
            border: 1px solid rgba(95, 179, 246, 0.4);
            border-radius: 8px;
            color: white;
            font-size: 12px;
            line-height: 1.5;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
            backdrop-filter: blur(10px);
            max-width: 280px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .pisa-tooltip.show { opacity: 1; }

        .box-style {
            color: white;
            background: rgba(10, 20, 40, 0.9);
            padding: clamp(12px, 3vw, 20px);
            border-radius: 12px;
            border: 1px solid rgba(95, 179, 246, 0.2);
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
            overflow-y: auto;
        }

        .description-box {
            position: absolute;
            top: 328px;
            left: 40px;
            width: clamp(270px, 90vw, 350px);
            max-height: calc(100vh - 420px);
        }

        .description-box h2 {
            margin: 0 0 15px 0;
            font-size: clamp(18px, 4vw, 24px);
            font-weight: 600;
            color: #5fb3f6;
        }

        .description-box p {
            margin: 0 0 12px 0;
            font-size: clamp(12px, 1.8vw, 14px);
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.85);
        }

        .controls {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(95, 179, 246, 0.2);
            font-size: clamp(10px, 1.5vw, 12px);
            color: rgba(255, 255, 255, 0.6);
        }

        .controls div { margin-bottom: 5px; }

        .country-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(95, 179, 246, 0.3);
        }

        .country-name {
            font-size: clamp(16px, 3.5vw, 20px);
            font-weight: 600;
            color: #5fb3f6;
        }

        .country-year {
            font-size: clamp(11px, 1.5vw, 13px);
            color: rgba(255, 255, 255, 0.6);
        }

        .timeline-container {
            position: absolute;
            bottom: 100px;
            right: 120px;
            height: 70vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .timeline-line {
            width: 2px;
            height: 100%;
            background: linear-gradient(to bottom, rgba(95, 179, 246, 0.3), rgba(95, 179, 246, 0.8) 50%, rgba(95, 179, 246, 0.3));
            position: relative;
        }

        .timeline-years {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .year-marker {
            position: relative;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .year-marker:hover .year-dot { transform: scale(1.5); background: #5fb3f6; box-shadow: 0 0 20px rgba(95, 179, 246, 0.8); }
        .year-marker:hover .year-label { color: #5fb3f6; transform: translateX(5px); }

        .year-dot {
            width: 12px;
            height: 12px;
            background: #5fb3f6;
            border: 2px solid #5fb3f6;
            border-radius: 50%;
            position: absolute;
            left: -5px;
            transition: all 0.3s;
            box-shadow: 0 0 10px rgba(95, 179, 246, 0.4);
        }

        .year-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 16px;
            font-weight: 600;
            margin-left: 25px;
            transition: all 0.3s;
            user-select: none;
        }

        .year-marker.active .year-dot { transform: scale(1.8); box-shadow: 0 0 25px rgba(95, 179, 246, 1); }
        .year-marker.active .year-label { color: #5fb3f6; font-size: 18px; }

        .legend-container {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            background: rgba(10, 20, 40, 0.9);
            padding: 12px 20px;
            border-radius: 12px;
            border: 1px solid rgba(95, 179, 246, 0.3);
            backdrop-filter: blur(10px);
        }

        .legend-title { color: #5fb3f6; font-size: 12px; font-weight: 600; margin-bottom: 6px; text-align: center; }
        .legend-gradient { width: 200px; height: 15px; background: linear-gradient(to right, #f7fcb9, #addd8e, #31a354); border-radius: 3px; margin-bottom: 5px; }
        .legend-labels { display: flex; justify-content: space-between; color: rgba(255, 255, 255, 0.7); font-size: 10px; }
        .legend-numbers { display: flex; justify-content: space-between; color: #5fb3f6; font-size: 11px; font-weight: 600; margin-top: 2px; }

        .country-path { transition: stroke 0.3s, stroke-width 0.3s; }
        .country-path.selected { stroke: #0099cc !important; stroke-width: 2.5 !important; filter: drop-shadow(0 0 15px rgba(0, 153, 204, 0.7)) !important; }
        .country-path.highest { stroke: #ffd700 !important; stroke-width: 3 !important; filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.9)) !important; }
        .country-path.lowest { stroke: #ff4444 !important; stroke-width: 3 !important; filter: drop-shadow(0 0 20px rgba(255, 68, 68, 0.9)) !important; }

        .stats-box {
            position: absolute;
            top: 90px;
            left: 40px;
            width: clamp(220px, 90vw, 263px);
            max-height: calc(100vh - 180px);
            z-index: 15;
        }

        .reset-button {
            position: absolute;
            bottom: 25px;
            left: 40px;
            width: clamp(220px, 90vw, 263px);
            background: rgba(95, 179, 246, 0.15);
            border: 1px solid rgba(95, 179, 246, 0.4);
            color: #5fb3f6;
            padding: clamp(10px, 2vw, 12px) clamp(15px, 3vw, 20px);
            border-radius: 8px;
            cursor: pointer;
            font-size: clamp(12px, 2vw, 14px);
            font-weight: 600;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            z-index: 15;
        }

        .reset-button:hover { background: rgba(95, 179, 246, 0.25); border-color: rgba(95, 179, 246, 0.6); box-shadow: 0 0 15px rgba(95, 179, 246, 0.3); }
        .reset-button:active { transform: scale(0.98); }

        .stats-box h3 {
            margin: 0 0 15px 0;
            font-size: clamp(14px, 2.5vw, 16px);
            font-weight: 600;
            color: #5fb3f6;
        }

        .stat-item {
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(95, 179, 246, 0.2);
        }

        .stat-item:last-child { margin-bottom: 0; padding-bottom: 0; border-bottom: none; }

        .stat-label {
            font-size: clamp(10px, 1.5vw, 12px);
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-highest { color: #ffd700; }
        .stat-lowest { color: #ff4444; }

        .stat-country {
            font-size: clamp(12px, 1.8vw, 14px);
            font-weight: 600;
            color: white;
            margin-bottom: 3px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .stat-country:hover { color: #5fb3f6; text-decoration: underline; }
        .stat-score { font-size: clamp(11px, 1.5vw, 13px); color: rgba(255, 255, 255, 0.8); }

        .chart-btn {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .chart-btn.active { background: rgba(95, 179, 246, 0.3); color: #5fb3f6; }

        /* Mobile Phone Optimizations - FIXED LAYOUT */
        @media (max-width: 480px) {
            /* Prevent any element from going off screen */
            body {
                overflow-x: hidden !important;
            }

            /* Header Elements - Stack vertically with proper spacing */
            .title { 
                font-size: 1.1em !important; 
                top: 10px !important; 
                left: 12px !important;
                right: 12px !important;
                width: calc(100vw - 24px) !important;
                text-align: center !important;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .nav-container { 
                top: 45px !important;
                left: 12px !important;
                right: 12px !important;
                transform: none !important;
                width: calc(100vw - 24px) !important;
                gap: 8px !important;
                padding: 6px !important;
                justify-content: center;
            }

            .nav-btn { 
                padding: 10px 20px !important; 
                font-size: 13px !important;
                min-height: 44px !important;
                flex: 1;
                max-width: 50%;
            }

            .search-container { 
                top: 100px !important; 
                right: 12px !important; 
                left: 12px !important; 
                width: calc(100vw - 24px) !important;
            }

            .search-input {
                padding: 12px 16px !important;
                font-size: 14px !important;
                min-height: 44px !important;
            }

            .search-results {
                max-height: 200px !important;
            }

            .search-result-item {
                padding: 14px 16px !important;
                font-size: 14px !important;
                min-height: 44px !important;
            }

            /* Fade Overlay */
            .fade-top-overlay { 
                height: 155px !important; 
            }

            /* Description Box - Below search with proper spacing */
            .description-box { 
                top: 155px !important;
                left: 12px !important;
                right: 12px !important;
                width: calc(100vw - 24px) !important;
                max-height: calc(100vh - 460px) !important;
                min-height: 150px !important;
                padding: 14px !important;
                overflow-y: auto !important;
                z-index: 11 !important;
            }

            .description-box h2 {
                font-size: 16px !important;
                margin-bottom: 10px !important;
            }

            .description-box p {
                font-size: 12px !important;
                margin-bottom: 8px !important;
                line-height: 1.5 !important;
            }

            .controls {
                font-size: 10px !important;
                margin-top: 10px !important;
                padding-top: 10px !important;
            }

            /* Stats Box - Below search with proper spacing */
            .stats-box { 
                top: 155px !important; 
                left: 12px !important; 
                right: 12px !important;
                width: calc(100vw - 24px) !important;
                max-height: calc(100vh - 460px) !important;
                min-height: 150px !important;
                padding: 14px !important;
                overflow-y: auto !important;
                z-index: 11 !important;
            }

            .stats-box h3 {
                font-size: 14px !important;
                margin-bottom: 12px !important;
            }

            .stat-item {
                margin-bottom: 12px !important;
                padding-bottom: 10px !important;
            }

            .stat-label {
                font-size: 10px !important;
            }

            .stat-country {
                font-size: 13px !important;
                min-height: 24px !important;
            }

            .stat-score {
                font-size: 11px !important;
            }

            /* Timeline - Horizontal at bottom, above legend */
            .timeline-container { 
                bottom: 120px !important;
                right: 12px !important;
                left: 12px !important;
                height: auto !important;
                width: calc(100vw - 24px) !important;
                flex-direction: row !important;
                z-index: 12 !important;
            }

            .timeline-line {
                width: 100% !important;
                height: 2px !important;
            }

            .timeline-years {
                flex-direction: row !important;
                justify-content: space-between !important;
                width: 100% !important;
                height: auto !important;
            }

            .year-marker {
                flex-direction: column !important;
                align-items: center !important;
            }

            .year-dot {
                position: relative !important;
                left: 0 !important;
                top: -5px !important;
                width: 10px !important;
                height: 10px !important;
            }

            .year-label {
                margin-left: 0 !important;
                margin-top: 8px !important;
                font-size: 11px !important;
                writing-mode: horizontal-tb !important;
            }

            .year-marker.active .year-label {
                font-size: 13px !important;
            }

            /* Reset Button - Above timeline */
            .reset-button { 
                bottom: 175px !important; 
                left: 12px !important; 
                right: 12px !important;
                width: calc(100vw - 24px) !important;
                padding: 14px 16px !important;
                font-size: 14px !important;
                min-height: 48px !important;
                z-index: 12 !important;
            }

            /* Legend - At very bottom */
            .legend-container { 
                bottom: 10px !important; 
                left: 12px !important;
                right: 12px !important;
                transform: none !important;
                width: calc(100vw - 24px) !important;
                padding: 10px 12px !important;
                z-index: 13 !important;
            }

            .legend-gradient {
                width: 100% !important;
                max-width: 250px !important;
                margin: 0 auto 5px auto !important;
            }

            .legend-title {
                font-size: 11px !important;
            }

            .legend-labels {
                font-size: 10px !important;
            }

            .legend-numbers {
                font-size: 11px !important;
            }

            /* Chart Container - Similar layout */
            #chart-container .box-style { 
                left: 12px !important; 
                right: 12px !important;
                top: 155px !important; 
                transform: none !important;
                width: calc(100vw - 24px) !important;
                max-height: calc(100vh - 340px) !important;
                min-height: 120px !important;
                padding: 14px !important;
                overflow-y: auto !important;
                z-index: 11 !important;
            }

            #chart-container .box-style h3 { 
                font-size: 14px !important; 
                margin-bottom: 10px !important;
            }

            #chart-container .box-style p { 
                font-size: 12px !important; 
                line-height: 1.5 !important;
            }

            #chart-container > div:last-child {
                bottom: 10px !important;
                left: 12px !important;
                right: 12px !important;
                transform: none !important;
                width: calc(100vw - 24px) !important;
                padding: 8px !important;
                gap: 6px !important;
                flex-wrap: wrap !important;
                justify-content: center !important;
                z-index: 13 !important;
            }

            .chart-btn {
                padding: 10px 14px !important;
                font-size: 11px !important;
                flex: 1 1 auto !important;
                min-width: 85px !important;
                min-height: 40px !important;
            }

            /* Tooltip */
            #tooltip {
                padding: 10px 12px !important;
                font-size: 12px !important;
                max-width: 200px !important;
                z-index: 150 !important;
            }

            .tooltip-country {
                font-size: 13px !important;
            }

            .tooltip-score {
                font-size: 11px !important;
            }

            .pisa-tooltip {
                max-width: calc(100vw - 40px) !important;
                font-size: 11px !important;
                z-index: 1001 !important;
            }

            /* Landing Page Mobile */
            .landing-paragraph {
                font-size: 15px !important;
                line-height: 1.7 !important;
                padding: 0 10px !important;
            }

            .landing-content {
                padding: 20px !important;
            }

            .unesco-link {
                margin-bottom: 25px !important;
            }

            .unesco-link a {
                font-size: 13px !important;
            }

            .uncover-btn {
                padding: 16px 35px !important;
                font-size: 16px !important;
                min-height: 52px !important;
            }

            /* Globe and Chart positioning */
            #globe-container, #chart-container {
                padding-top: 0 !important;
            }

            #globe, #chart {
                margin-top: 0 !important;
            }

            /* Ensure SVG doesn't overflow */
            svg {
                max-width: 100vw !important;
                overflow: visible !important;
            }
        }

        /* Tablet Adjustments */
        @media (min-width: 481px) and (max-width: 768px) {
            .title { 
                font-size: 1.5em !important; 
                top: 15px !important; 
                left: 20px !important;
                right: 20px !important;
            }

            .nav-container { 
                top: 60px !important;
                left: 20px !important;
                right: 20px !important;
                transform: none !important;
                width: calc(100vw - 40px) !important;
            }

            .search-container { 
                top: 115px !important; 
                right: 20px !important; 
                left: 20px !important;
                width: calc(100vw - 40px) !important;
            }

            .fade-top-overlay {
                height: 170px !important;
            }

            .timeline-container {
                bottom: 80px !important;
                right: 20px !important;
                height: 50vh !important;
            }

            .legend-container {
                bottom: 15px !important;
                left: 20px !important;
                transform: none !important;
                width: auto !important;
                max-width: 350px !important;
            }

            .description-box {
                top: 170px !important;
                left: 20px !important;
                width: calc(50vw - 30px) !important;
                max-width: 350px !important;
                max-height: calc(100vh - 340px) !important;
            }

            .stats-box {
                top: 170px !important;
                left: 20px !important;
                width: calc(50vw - 30px) !important;
                max-width: 320px !important;
                max-height: calc(100vh - 340px) !important;
            }

            .reset-button {
                bottom: 100px !important;
                left: 20px !important;
                width: calc(50vw - 30px) !important;
                max-width: 320px !important;
            }

            #chart-container .box-style {
                top: 170px !important;
                left: 20px !important;
                width: calc(50vw - 30px) !important;
                max-width: 350px !important;
                max-height: calc(100vh - 280px) !important;
            }

            #chart-container > div:last-child {
                bottom: 15px !important;
                left: 50% !important;
                transform: translateX(-50%) !important;
                width: auto !important;
            }
        }

        /* Extra Small Mobile - Additional tweaks for very small screens */
        @media (max-width: 380px) {
            .title {
                font-size: 1em !important;
            }

            .nav-btn {
                font-size: 12px !important;
                padding: 8px 15px !important;
            }

            .description-box,
            .stats-box {
                max-height: calc(100vh - 480px) !important;
            }

            .chart-btn {
                font-size: 10px !important;
                min-width: 75px !important;
                padding: 8px 10px !important;
            }

            .year-label {
                font-size: 10px !important;
            }

            .year-marker.active .year-label {
                font-size: 11px !important;
            }
        }

        /* Landscape Mobile */
        @media (max-height: 600px) and (orientation: landscape) {
            .title { 
                font-size: 1em !important; 
                top: 8px !important; 
                left: 12px !important; 
            }

            .nav-container { 
                top: 8px !important;
                gap: 6px !important;
                padding: 5px !important;
            }

            .nav-btn {
                padding: 8px 16px !important;
                font-size: 12px !important;
            }

            .search-container { 
                top: 50px !important;
                right: 12px !important;
                left: 12px !important;
            }

            .timeline-container { 
                bottom: 12px !important; 
                right: 100px !important; 
                height: calc(100vh - 80px) !important; 
            }

            .legend-container { 
                bottom: 12px !important; 
                left: 12px !important;
            }

            .description-box,
            .stats-box { 
                top: 95px !important;
                max-height: calc(100vh - 160px) !important;
            }

            .reset-button { 
                bottom: 12px !important; 
            }

            #chart-container .box-style { 
                top: 95px !important; 
                max-height: calc(100vh - 160px) !important;
            }

            #chart-container > div:last-child { 
                bottom: 10px !important; 
            }
        }
    </style>
</head>
<body>
    <div id="landing-page">
        <div class="landing-content">
            <p class="landing-paragraph">
                In some classrooms, learning is a joy, lessons flow easily, voices are heard. But elsewhere, millions of children struggle to understand words not written in their language, feeling like outsiders in their own schools. While some are born into systems that nurture potential, others must fight barriers just to be seen, reminding us how uneven the world of education truly is.
            </p>
            <div class="unesco-link">
                <a href="https://www.unesco.org/en/articles/new-unesco-report-shows-extent-global-inequalities-education-and-calls-greater-inclusion-schools-re#:~:text=The%202020%20Global%20Education%20Monitoring%20(GEM)%20Report,labor%20is%20still%20permitted%20in%20some%20countries" target="_blank" rel="noopener noreferrer">(UNESCO, 2023)</a>
            </div>
            <button class="uncover-btn" id="uncover-btn">Uncover the Truth</button>
        </div>
    </div>

    <div id="visualization-container">
        <div class="fade-top-overlay"></div>
        <h1 class="title" id="page-title">A World of Unequal Learning</h1>

        <div class="nav-container">
            <button class="nav-btn active" id="nav-globe">Globe</button>
            <button class="nav-btn" id="nav-chart">Chart</button>
        </div>

        <div class="search-container" id="search-container">
            <input type="text" id="search-input" placeholder="Search country..." class="search-input">
            <div id="search-results" class="search-results"></div>
        </div>

        <div class="tooltip" id="tooltip">
            <div class="tooltip-country"></div>
            <div class="tooltip-score"></div>
        </div>

        <div class="pisa-tooltip" id="pisa-tooltip">
            PISA scores show how well 15-year-olds apply knowledge in reading, math, and science. The global average is 500. Scores above 500 show better-than-average performance; below 500 means below average.
        </div>

        <div id="globe-container">
            <svg id="globe"></svg>
            
            <div class="description-box box-style default" id="description-box">
                <h2>How is it unequal?</h2>            
                <p>In some parts of the world, classrooms glow with possibility, students have access to the internet, freedom to learn, and the support to dream. In others, the light is dimmer, opportunities fade where resources and hope run thin. These numbers whisper a truth: talent is everywhere, but opportunity is not.</p>
                <p>Measured by <span class="pisa-term" id="pisa-term">PISA score</span>, it shows how well 15-year-olds perform in reading, math, and science.</p>
                <div class="controls">
                    <div>Drag to rotate the globe</div>
                    <div>Scroll to zoom in and out</div>
                    <div>Click on a country to focus</div>
                    <div>Use the timeline to change year</div>
                </div>
            </div>

            <div class="stats-box box-style">
                <h3>Avg. Students' Performance Across the Globe</h3>
                <div class="stat-item">
                    <div class="stat-label stat-highest">üèÜ Highest Performance</div>
                    <div class="stat-country" id="highest-country">-</div>
                    <div class="stat-score" id="highest-score">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label stat-lowest">üìç Lowest Performance</div>
                    <div class="stat-country" id="lowest-country">-</div>
                    <div class="stat-score" id="lowest-score">-</div>
                </div>
            </div>

            <button class="reset-button" id="reset-button">‚Ü∫ Reset View</button>

            <div class="timeline-container">
                <div class="timeline-line">
                    <div class="timeline-years" id="timeline-years"></div>
                </div>
            </div>

            <div class="legend-container">
                <div class="legend-title">Student Performance Score</div>
                <div class="legend-gradient"></div>
                <div class="legend-labels">
                    <span>Low</span>
                    <span>High</span>
                </div>
                <div class="legend-numbers">
                    <span id="legend-min">-</span>
                    <span id="legend-max">-</span>
                </div>
            </div>
        </div>

        <div id="chart-container">
            <div class="box-style" style="position: absolute; left: 40px; top: 50%; transform: translateY(-50%); width: clamp(200px, 20vw, 300px); max-height: 70vh; z-index: 15;" id="scatter-description">
                <h3 style="margin: 0 0 12px 0; font-size: 16px; font-weight: 600; color: #5fb3f6;">Study Hours</h3>
                <p style="margin: 0; font-size: 13px; line-height: 1.6;">Students who spend more time studying generally achieve higher exam scores. The trend shows a positive relationship, as study hours increase, exam performance improves.</p>
            </div>
            <svg id="chart"></svg>
            <div style="position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%); z-index: 20; display: flex; gap: 10px; background: rgba(10, 20, 40, 0.9); padding: 10px 15px; border-radius: 25px; border: 1px solid rgba(95, 179, 246, 0.3);">
                <button id="btn-study" class="chart-btn active">Study Hours</button>
                <button id="btn-social" class="chart-btn">Social Media Hours</button>
                <button id="btn-sleep" class="chart-btn">Sleep Hours</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <script>
        document.getElementById('uncover-btn').addEventListener('click', function() {
            document.getElementById('landing-page').classList.add('slide-up');
            document.getElementById('visualization-container').classList.add('slide-up');
        });

        const Config = {
            width: window.innerWidth,
            height: window.innerHeight,
            baseScale: window.innerWidth <= 480 ? Math.min(window.innerWidth, window.innerHeight) * 0.35 :
                       window.innerWidth <= 768 ? Math.min(window.innerWidth, window.innerHeight) * 0.38 :
                       Math.min(window.innerWidth, window.innerHeight) * 0.4,
            colors: { primary: '#5fb3f6', gold: '#ffd700', red: '#ff4444', cyan: '#0099cc', darkBg: '#0d1b2e', darkStroke: '#1a3a52' }
        };

        const state = {
            data: [], countries: [], year: 2018, selected: null, zoomed: false, dragging: false,
            stats: { avg: 0, min: 0, max: 0, highest: null, lowest: null },
            rotationTimer: null, rotation: { x: 0, y: -10 },
            scatterData: [], currentVariable: 'study_hours_per_day'
        };

        const els = {
            navGlobe: document.getElementById('nav-globe'),
            navChart: document.getElementById('nav-chart'),
            globeContainer: document.getElementById('globe-container'),
            chartContainer: document.getElementById('chart-container'),
            searchInput: document.getElementById('search-input'),
            searchResults: document.getElementById('search-results'),
            description: document.getElementById('description-box'),
            tooltip: document.getElementById('tooltip'),
            resetBtn: document.getElementById('reset-button'),
            globe: d3.select('#globe'),
            chart: d3.select('#chart'),
            timeline: d3.select('#timeline-years'),
            highest: document.getElementById('highest-country'),
            highestScore: document.getElementById('highest-score'),
            lowest: document.getElementById('lowest-country'),
            lowestScore: document.getElementById('lowest-score')
        };

        let projection = d3.geoOrthographic()
            .scale(Config.baseScale)
            .center([0, 0])
            .rotate([0, -10])
            .translate([Config.width / 2, Config.height / 2]);

        let pathGen = d3.geoPath().projection(projection);

        function scoreColor(score, avg, min, max) {
            const normalized = (score - min) / (max - min);
            return normalized < 0.5 
                ? d3.interpolateRgb('#f7fcb9', '#addd8e')(normalized * 2)
                : d3.interpolateRgb('#addd8e', '#31a354')((normalized - 0.5) * 2);
        }

        function setupPisaTooltip() {
            const pisaTerm = document.getElementById('pisa-term');
            const pisaTooltip = document.getElementById('pisa-tooltip');
            
            if (pisaTerm) {
                pisaTerm.addEventListener('mouseenter', (e) => {
                    pisaTooltip.classList.add('show');
                    const rect = pisaTerm.getBoundingClientRect();
                    pisaTooltip.style.left = (rect.left + window.scrollX) + 'px';
                    pisaTooltip.style.top = (rect.bottom + window.scrollY + 8) + 'px';
                });
                
                pisaTerm.addEventListener('mouseleave', () => {
                    pisaTooltip.classList.remove('show');
                });
            }
        }

        function setupGlobe() {
            els.globe.attr('width', Config.width).attr('height', Config.height);

            els.globe.append('circle')
                .attr('cx', Config.width / 2)
                .attr('cy', Config.height / 2)
                .attr('r', projection.scale())
                .attr('fill', Config.colors.darkBg)
                .attr('stroke', Config.colors.darkStroke)
                .attr('stroke-width', 1.5)
                .attr('id', 'globe-circle');

            els.globe.append('g').attr('class', 'countries-group');

            els.globe.call(d3.drag().on('start', dragStart).on('drag', dragging).on('end', dragEnd));
            els.globe.call(d3.zoom().scaleExtent([0.7, 2.5]).on('zoom', handleZoom));
        }

        function loadData() {
            Promise.all([
                fetch('https://raw.githubusercontent.com/astanaa/Data_Visualization_Project/refs/heads/main/Dataset/World_Education%20-%20Final.csv').then(r => r.text()),
                d3.json('https://cdn.jsdelivr.net/npm/world-atlas@2/countries-50m.json')
            ]).then(([csvText, world]) => {
                state.data = Papa.parse(csvText, { header: true, dynamicTyping: true, skipEmptyLines: true }).data;
                state.countries = topojson.feature(world, world.objects.countries).features;
                buildTimeline([...new Set(state.data.map(d => d.Year))].sort((a, b) => a - b));
                draw();
                updateStats();
                autoRotate();
            }).catch(err => console.error('Data load failed:', err));
        }

        function draw() {
            const group = els.globe.select('.countries-group');
            group.selectAll('path').remove();
            group.selectAll('path')
                .data(state.countries)
                .enter()
                .append('path')
                .attr('d', pathGen)
                .attr('stroke', Config.colors.darkBg)
                .attr('stroke-width', 0.5)
                .attr('class', 'country-path')
                .style('filter', 'drop-shadow(0 0 5px rgba(0,0,0,0.5))')
                .style('cursor', 'pointer')
                .on('click', (e, d) => { e.stopPropagation(); handleCountryClick(d); })
                .on('mouseover', (e, d) => showTooltip(e, d))
                .on('mousemove', (e) => d3.select('#tooltip').style('left', (e.pageX + 15) + 'px').style('top', (e.pageY - 28) + 'px'))
                .on('mouseout', () => d3.select('#tooltip').classed('show', false));
        }

        function buildTimeline(years) {
            els.timeline.selectAll('*').remove();
            years.forEach(yr => {
                const item = els.timeline.append('div')
                    .attr('class', yr === state.year ? 'year-marker active' : 'year-marker')
                    .on('click', () => selectYear(yr));
                item.append('div').attr('class', 'year-dot');
                item.append('div').attr('class', 'year-label').text(yr);
            });
        }

        function selectYear(yr) {
            state.year = yr;
            d3.selectAll('.year-marker').classed('active', false);
            d3.selectAll('.year-marker').filter(function() {
                return d3.select(this).select('.year-label').text() == yr;
            }).classed('active', true);
            updateStats();
            if (state.selected) updateInfo(state.selected);
        }

        function handleCountryClick(feature) {
            if (state.zoomed && state.selected === feature) zoomOut();
            else if (state.zoomed) panTo(feature);
            else zoomIn(feature);
        }

        function showTooltip(e, feature) {
            const name = feature.properties.name;
            const row = state.data.find(d => d.Entity === name && d.Year === state.year);
            const tip = d3.select('#tooltip');
            tip.select('.tooltip-country').text(name);
            tip.select('.tooltip-score').text(row && row["Average student's performance"] 
                ? `Score: ${row["Average student's performance"].toFixed(1)}` : 'No data');
            tip.classed('show', true).style('left', (e.pageX + 15) + 'px').style('top', (e.pageY - 28) + 'px');
        }

        function zoomIn(feature) {
            state.selected = feature;
            state.zoomed = true;
            highlightSelected();
            updateInfo(feature);
            if (state.rotationTimer) cancelAnimationFrame(state.rotationTimer);

            const center = d3.geoCentroid(feature);
            const targetRotate = [-center[0], -center[1]];
            const currentRotate = projection.rotate();
            const currentScale = projection.scale();
            const targetScale = currentScale * 2.5;

            d3.transition().duration(1000)
                .tween('rotate', () => {
                    const r = d3.interpolate(currentRotate, targetRotate);
                    return (t) => { projection.rotate(r(t)); refresh(); };
                })
                .tween('zoom', () => {
                    const s = d3.interpolate(currentScale, targetScale);
                    return (t) => { 
                        projection.scale(s(t)); 
                        d3.select('#globe-circle').attr('r', s(t)); 
                        refresh(); 
                    };
                });
        }

        function panTo(feature) {
            state.selected = feature;
            highlightSelected();
            updateInfo(feature);
            const center = d3.geoCentroid(feature);
            const targetRotate = [-center[0], -center[1]];
            d3.transition().duration(800)
                .tween('rotate', () => {
                    const r = d3.interpolate(projection.rotate(), targetRotate);
                    return (t) => { projection.rotate(r(t)); refresh(); };
                });
        }

        function zoomOut() {
            state.selected = null;
            state.zoomed = false;
            highlightSelected();
            resetInfo();
            d3.transition().duration(1000)
                .tween('zoom', () => {
                    const s = d3.interpolate(projection.scale(), Config.baseScale);
                    return (t) => { 
                        projection.scale(s(t)); 
                        d3.select('#globe-circle').attr('r', s(t)); 
                        refresh(); 
                    };
                })
                .on('end', autoRotate);
        }

        function highlightSelected() {
            d3.selectAll('.country-path').classed('selected', d => state.selected === d);
        }

        function refresh() {
            d3.selectAll('.country-path').attr('d', pathGen);
        }

        function updateInfo(feature) {
            const name = feature.properties.name;
            const row = state.data.find(d => d.Entity === name && d.Year === state.year);
            if (!row) { resetInfo(); return; }

            els.description.classList.remove('default');
            els.description.innerHTML = `
                <div class="country-header">
                    <div class="country-name">${name}</div>
                    <div class="country-year">Year: ${state.year}</div>
                </div>`;

            const metrics = extractMetrics(row);
            if (metrics.hasData) drawRadar(metrics);
            else els.description.innerHTML += '<div style="font-size: 13px; color: rgba(255, 100, 100, 0.8); font-style: italic;">No data available for this country.</div>';
        }

        function resetInfo() {
            els.description.classList.add('default');
            els.description.innerHTML = `
                <h2>How is it unequal?</h2>            
                <p>In some parts of the world, classrooms glow with possibility, students have access to the internet, freedom to learn, and the support to dream. In others, the light is dimmer, opportunities fade where resources and hope run thin. These numbers whisper a truth: talent is everywhere, but opportunity is not.</p>
                <p>Measured by <span class="pisa-term" id="pisa-term">PISA score</span>, it shows how well 15-year-olds perform in reading, math, and science.</p>
                <div class="controls">
                    <div>Drag to rotate the globe</div>
                    <div>Scroll to zoom in and out</div>
                    <div>Click on a country to focus</div>
                    <div>Use the timeline to change year</div>
                </div>`;
            setupPisaTooltip();
        }

        function extractMetrics(row) {
            const metrics = { 'Internet Users': 0, 'Happiness': 0, 'Academic Freedom': 0, 'Primary Enrollment': 0, 'Secondary Enrollment': 0, hasData: false, raw: {} };
            const fields = [
                { key: 'Internet Users', field: 'Ratio of internet users by population', scaled: 'none', fmt: v => v.toFixed(1) + '%' },
                { key: 'Happiness', field: 'Happiness score', scaled: 'scaled Happiness score', fmt: v => v.toFixed(2) },
                { key: 'Academic Freedom', field: 'Academic freedom index', scaled: 'scaled Academic freedom index', fmt: v => v.toFixed(3) },
                { key: 'Primary Enrollment', field: 'Gross enrolment ratio in primary education', scaled: 'scaled Gross enrolment ratio in primary education', fmt: v => v.toFixed(1) + '%' },
                { key: 'Secondary Enrollment', field: 'Gross enrolment ratio in secondary education', scaled: 'scaled Gross enrolment ratio in secondary education', fmt: v => v.toFixed(1) + '%' }
            ];

            let count = 0;
            fields.forEach(f => {
                const val = parseFloat(row[f.field]);
                if (!isNaN(val) && val > 0) {
                    const scaled = f.scaled !== 'none' ? parseFloat(row[f.scaled]) || 0 : val;
                    metrics[f.key] = Math.min(100, scaled);
                    metrics.raw[f.key] = f.fmt(val);
                    count++;
                }
            });
            metrics.hasData = count >= 3;
            return metrics;
        }

        function drawRadar(metrics) {
            const container = document.createElement('div');
            container.style.cssText = 'text-align: center; margin-top: 10px; margin-left: 15px;';
            els.description.appendChild(container);

            const data = [
                { axis: 'Internet Users', value: metrics['Internet Users'], raw: metrics.raw['Internet Users'] },
                { axis: 'Happiness', value: metrics['Happiness'], raw: metrics.raw['Happiness'] },
                { axis: 'Academic Freedom', value: metrics['Academic Freedom'], raw: metrics.raw['Academic Freedom'] },
                { axis: 'Primary Enrollment', value: metrics['Primary Enrollment'], raw: metrics.raw['Primary Enrollment'] },
                { axis: 'Secondary Enrollment', value: metrics['Secondary Enrollment'], raw: metrics.raw['Secondary Enrollment'] }
            ];

            const w = 200, h = 200, r = Math.min(w, h) / 2 - 25;
            const svg = d3.select(container).append('svg')
                .attr('width', w).attr('height', h)
                .style('display', 'block').style('margin', '0 auto')
                .append('g').attr('transform', `translate(${w / 2}, ${h / 2})`);

            const angle = (Math.PI * 2) / data.length;
            const scale = d3.scaleLinear().domain([0, 100]).range([0, r]);

            for (let i = 1; i <= 5; i++) {
                svg.append('circle').attr('r', (r / 5) * i)
                    .attr('fill', 'none').attr('stroke', 'rgba(95, 179, 246, 0.2)').attr('stroke-width', 1);
            }

            data.forEach((d, i) => {
                const a = angle * i - Math.PI / 2;
                const x = r * Math.cos(a), y = r * Math.sin(a);
                svg.append('line').attr('x1', 0).attr('y1', 0).attr('x2', x).attr('y2', y)
                    .attr('stroke', 'rgba(95, 179, 246, 0.2)').attr('stroke-width', 1);

                const labelRadius = r + 8;
                const lx = labelRadius * Math.cos(a), ly = labelRadius * Math.sin(a);
                const parts = d.axis.split(' ');

                if (parts.length > 1) {
                    svg.append('text').attr('x', lx).attr('y', ly - 5)
                        .attr('text-anchor', 'middle').attr('font-size', '8px')
                        .attr('fill', Config.colors.primary).attr('font-weight', '600').text(parts[0]);
                    svg.append('text').attr('x', lx).attr('y', ly + 5)
                        .attr('text-anchor', 'middle').attr('font-size', '8px')
                        .attr('fill', Config.colors.primary).attr('font-weight', '600').text(parts.slice(1).join(' '));
                } else {
                    svg.append('text').attr('x', lx).attr('y', ly)
                        .attr('text-anchor', 'middle').attr('dy', '0.3em').attr('font-size', '8px')
                        .attr('fill', Config.colors.primary).attr('font-weight', '600').text(d.axis);
                }
            });

            let path = '';
            data.forEach((d, i) => {
                const a = angle * i - Math.PI / 2;
                const x = scale(d.value) * Math.cos(a), y = scale(d.value) * Math.sin(a);
                path += (i === 0 ? `M ${x} ${y}` : ` L ${x} ${y}`);
            });
            path += ' Z';

            svg.append('path').attr('d', path)
                .attr('fill', 'rgba(95, 179, 246, 0.25)')
                .attr('stroke', Config.colors.primary)
                .attr('stroke-width', 2).attr('stroke-linejoin', 'round');

            data.forEach((d, i) => {
                const a = angle * i - Math.PI / 2;
                const x = scale(d.value) * Math.cos(a), y = scale(d.value) * Math.sin(a);
                svg.append('circle').attr('cx', x).attr('cy', y).attr('r', 2)
                    .attr('fill', Config.colors.primary).attr('stroke', 'white').attr('stroke-width', 1);
            });

            const legend = document.createElement('div');
            legend.style.cssText = 'margin-top: 8px; font-size: 11px; line-height: 1.5; color: rgba(255, 255, 255, 0.85); text-align: left;';
            legend.innerHTML = `<strong style="color: #5fb3f6; display: block; margin-bottom: 5px;">Metrics:</strong>
                ‚Ä¢ <strong>Internet User by Population:</strong> ${data[0].raw}<br>
                ‚Ä¢ <strong>Happiness Level (1-10):</strong> ${data[1].raw}<br>
                ‚Ä¢ <strong>Academic Freedom (0-1):</strong> ${data[2].raw}<br>
                ‚Ä¢ <strong>Primary School Enrolment Rate:</strong> ${data[3].raw}<br>
                ‚Ä¢ <strong>Secondary School Enrolment Rate:</strong> ${data[4].raw}`;
            els.description.appendChild(legend);
        }

        function updateStats() {
            const yearData = state.data.filter(d => d.Year === state.year);
            const scores = yearData.map(d => d["Average student's performance"]).filter(s => s != null && !isNaN(s));

            state.stats.avg = d3.mean(scores);
            state.stats.min = d3.min(scores);
            state.stats.max = d3.max(scores);

            d3.select('#legend-min').text(state.stats.min?.toFixed(1) || '-');
            d3.select('#legend-max').text(state.stats.max?.toFixed(1) || '-');

            let highest = { country: null, score: -Infinity };
            let lowest = { country: null, score: Infinity };

            yearData.forEach(row => {
                const score = row["Average student's performance"];
                if (score != null && !isNaN(score)) {
                    if (score > highest.score) highest = { country: row.Entity, score };
                    if (score < lowest.score) lowest = { country: row.Entity, score };
                }
            });

            state.stats.highest = highest.country;
            state.stats.lowest = lowest.country;

            els.highest.textContent = highest.country || '-';
            els.highestScore.textContent = `Score: ${highest.score.toFixed(1)}`;
            els.lowest.textContent = lowest.country || '-';
            els.lowestScore.textContent = `Score: ${lowest.score.toFixed(1)}`;

            els.highest.onclick = () => selectFromSearch(highest.country);
            els.lowest.onclick = () => selectFromSearch(lowest.country);

            d3.selectAll('.country-path').transition().duration(500)
                .attr('fill', (d) => {
                    const name = d.properties.name;
                    const row = yearData.find(r => r.Entity === name);
                    return row && row["Average student's performance"]
                        ? scoreColor(row["Average student's performance"], state.stats.avg, state.stats.min, state.stats.max)
                        : '#1e3a52';
                })
                .on('end', () => {
                    d3.selectAll('.country-path')
                        .classed('highest', d => d.properties.name === highest.country)
                        .classed('lowest', d => d.properties.name === lowest.country);
                });
        }

        function autoRotate() {
            if (state.rotationTimer) cancelAnimationFrame(state.rotationTimer);
            
            function animate() {
                if (!state.dragging && !state.zoomed) {
                    state.rotation.x += 0.15;
                    projection.rotate([state.rotation.x, state.rotation.y]);
                    refresh();
                    state.rotationTimer = requestAnimationFrame(animate);
                }
            }
            state.rotationTimer = requestAnimationFrame(animate);
        }

        function dragStart() {
            state.dragging = true;
            if (state.rotationTimer && !state.zoomed) cancelAnimationFrame(state.rotationTimer);
        }

        function dragging(e) {
            const k = 75 / projection.scale();
            const curr = projection.rotate();
            state.rotation.x = curr[0] + e.dx * k;
            state.rotation.y = Math.max(-90, Math.min(90, curr[1] - e.dy * k));
            projection.rotate([state.rotation.x, state.rotation.y]);
            refresh();
        }

        function dragEnd() {
            state.dragging = false;
            if (!state.zoomed) autoRotate();
        }

        function handleZoom(e) {
            if (e.sourceEvent && e.sourceEvent.type === 'wheel') {
                const newScale = Config.baseScale * e.transform.k;
                projection.scale(newScale);
                d3.select('#globe-circle').attr('r', newScale);
                refresh();
            }
        }

        function debounce(fn, delay) {
            let timer;
            return (e) => { clearTimeout(timer); timer = setTimeout(() => fn(e), delay); };
        }

        els.searchInput.addEventListener('input', debounce((e) => {
            const query = e.target.value.trim().toLowerCase();
            if (query.length === 0) { els.searchResults.classList.remove('show'); return; }

            const countries = [...new Set(state.data.map(d => d.Entity))];
            const filtered = countries.filter(c => c.toLowerCase().includes(query)).sort().slice(0, 8);

            if (filtered.length === 0) {
                els.searchResults.innerHTML = '<div class="search-result-item" style="color: rgba(255, 255, 255, 0.5);">No results</div>';
                els.searchResults.classList.add('show');
                return;
            }

            els.searchResults.innerHTML = filtered.map(c => `<div class="search-result-item" data-country="${c}">${c}</div>`).join('');
            document.querySelectorAll('.search-result-item[data-country]').forEach(item => {
                item.addEventListener('click', () => selectFromSearch(item.getAttribute('data-country')));
            });
            els.searchResults.classList.add('show');
        }, 300));

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.search-container')) els.searchResults.classList.remove('show');
        });

        function selectFromSearch(country) {
            const feature = state.countries.find(f => f.properties.name === country);
            if (feature) {
                handleCountryClick(feature);
                els.searchInput.value = '';
                els.searchResults.classList.remove('show');
            }
        }

        els.navGlobe.addEventListener('click', () => {
            els.navGlobe.classList.add('active');
            els.navChart.classList.remove('active');
            els.globeContainer.classList.remove('slide-up');
            els.chartContainer.classList.remove('slide-up');
            document.getElementById('page-title').textContent = 'A World of Unequal Learning';
            document.getElementById('search-container').style.display = 'block';
        });

        els.navChart.addEventListener('click', () => {
            els.navChart.classList.add('active');
            els.navGlobe.classList.remove('active');
            els.globeContainer.classList.add('slide-up');
            els.chartContainer.classList.add('slide-up');
            document.getElementById('page-title').textContent = "Smart Habits, Better Scores";
            document.getElementById('search-container').style.display = 'none';
        });

        els.resetBtn.addEventListener('click', zoomOut);

        ['study', 'social', 'sleep'].forEach(type => {
            const varMap = { study: 'study_hours_per_day', social: 'social_media_hours', sleep: 'sleep_hours' };
            document.getElementById(`btn-${type}`).addEventListener('click', () => {
                state.currentVariable = varMap[type];
                drawScatterPlot(state.scatterData, varMap[type]);
                updateChartButtons(`btn-${type}`);
            });
        });

        function updateChartButtons(activeId) {
            document.querySelectorAll('.chart-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(activeId).classList.add('active');

            const descriptions = {
                'btn-study': {
                    title: 'Study Hours',
                    text: 'Students who spend more time studying generally achieve higher exam scores. The trend shows a positive relationship, as study hours increase, exam performance improves.'
                },
                'btn-social': {
                    title: 'Social Media Hours',
                    text: 'There is a negative relationship between social media usage and exam scores. Students who spend more hours on social media tend to have lower exam performance, possibly due to reduced focus and study time.'
                },
                'btn-sleep': {
                    title: 'Sleep Hours',
                    text: 'The relationship between sleep and exam performance appears moderately positive up to an optimal point. Students who sleep around 7‚Äì8 hours tend to perform best.'
                }
            };

            const desc = descriptions[activeId];
            document.getElementById('scatter-description').innerHTML = `
                <h3 style="margin: 0 0 12px 0; font-size: 16px; font-weight: 600; color: #5fb3f6;">${desc.title}</h3>
                <p style="margin: 0; font-size: 13px; line-height: 1.6;">${desc.text}</p>`;
        }

        window.addEventListener('resize', () => {
            Config.width = window.innerWidth;
            Config.height = window.innerHeight;
            
            // Adjust scale based on screen size - smaller on mobile
            if (window.innerWidth <= 480) {
                Config.baseScale = Math.min(Config.width, Config.height) * 0.35;
            } else if (window.innerWidth <= 768) {
                Config.baseScale = Math.min(Config.width, Config.height) * 0.38;
            } else {
                Config.baseScale = Math.min(Config.width, Config.height) * 0.4;
            }
            
            els.globe.attr('width', Config.width).attr('height', Config.height);
            projection.scale(Config.baseScale).translate([Config.width / 2, Config.height / 2]);
            d3.select('#globe-circle').attr('cx', Config.width / 2).attr('cy', Config.height / 2).attr('r', Config.baseScale);
            refresh();
            
            if (state.scatterData.length > 0) {
                drawScatterPlot(state.scatterData, state.currentVariable);
            }
        });

        // Initial scale adjustment for mobile
        function adjustInitialScale() {
            if (window.innerWidth <= 480) {
                Config.baseScale = Math.min(Config.width, Config.height) * 0.35;
                projection.scale(Config.baseScale);
                d3.select('#globe-circle').attr('r', Config.baseScale);
            } else if (window.innerWidth <= 768) {
                Config.baseScale = Math.min(Config.width, Config.height) * 0.38;
                projection.scale(Config.baseScale);
                d3.select('#globe-circle').attr('r', Config.baseScale);
            }
        }

        function loadScatterData() {
            fetch('https://raw.githubusercontent.com/astanaa/Data_Visualization_Project/refs/heads/main/Dataset/Student_Habits_Dataset.csv')
                .then(r => r.text())
                .then(csvText => {
                    state.scatterData = Papa.parse(csvText, { header: true, dynamicTyping: true, skipEmptyLines: true }).data;
                    drawScatterPlot(state.scatterData, 'study_hours_per_day');
                })
                .catch(err => console.error('Scatter data load failed:', err));
        }

        function drawScatterPlot(data, variable = 'study_hours_per_day') {
            const validData = data.filter(d => d[variable] != null && d['exam_score'] != null && !isNaN(d[variable]) && !isNaN(d['exam_score']));
            if (validData.length === 0) { console.error('No valid data for scatter plot'); return; }

            // Adjust dimensions based on screen size
            let descBoxWidth, availableWidth, plotWidth, plotHeight, margin, centerX, centerY;
            
            if (window.innerWidth <= 480) {
                // Mobile layout - chart takes more vertical space
                descBoxWidth = 0;
                availableWidth = Config.width - 24;
                plotWidth = Math.min(availableWidth, 400);
                plotHeight = Math.min(Config.height * 0.45, 350);
                margin = { top: 20, right: 20, bottom: 45, left: 50 };
                centerX = Config.width / 2;
                centerY = Config.height / 2 + 30;
            } else if (window.innerWidth <= 768) {
                // Tablet layout
                descBoxWidth = Math.min(280, Config.width * 0.3);
                availableWidth = Config.width - descBoxWidth - 60;
                plotWidth = Math.min(availableWidth * 0.9, 600);
                plotHeight = Math.min(Config.height * 0.55, 450);
                margin = { top: 25, right: 25, bottom: 45, left: 55 };
                centerX = descBoxWidth + (Config.width - descBoxWidth) / 2;
                centerY = Config.height / 2 + 20;
            } else {
                // Desktop layout
                descBoxWidth = Math.min(350, Config.width * 0.25);
                availableWidth = Config.width - descBoxWidth - 80;
                plotWidth = Math.max(Math.min(availableWidth * 0.9, 1200), 400);
                plotHeight = Math.max(Math.min(Config.height * 0.60, 600), 350);
                margin = { top: 30, right: 30, bottom: 50, left: 60 };
                centerX = Math.max(descBoxWidth + 40, descBoxWidth + (Config.width - descBoxWidth - plotWidth) / 2);
                centerY = (Config.height - plotHeight) / 2;
            }

            const width = plotWidth - margin.left - margin.right;
            const height = plotHeight - margin.top - margin.bottom;

            els.chart.selectAll('*').remove();

            const g = els.chart.attr('width', Config.width).attr('height', Config.height)
                .append('g').attr('transform', `translate(${centerX - width/2 + margin.left},${centerY - height/2 + margin.top})`);

            const xScale = d3.scaleLinear().domain([0, d3.max(validData, d => d[variable]) * 1.1]).range([0, width]);
            const yScale = d3.scaleLinear().domain([0, d3.max(validData, d => d['exam_score']) * 1.05]).range([height, 0]);

            const variableLabels = {
                'study_hours_per_day': 'Study Hours Per Day',
                'social_media_hours': 'Social Media Hours Per Day',
                'sleep_hours': 'Sleep Hours Per Day'
            };
            const xAxisLabel = variableLabels[variable] || variable;

            // Adjust font sizes for mobile
            const axisFontSize = window.innerWidth <= 480 ? '13px' : '16px';
            const tickFontSize = window.innerWidth <= 480 ? '10px' : '11px';

            g.append('g').attr('transform', `translate(0,${height})`).call(d3.axisBottom(xScale).ticks(window.innerWidth <= 480 ? 5 : 7))
                .attr('color', 'rgba(255, 255, 255, 0.6)')
                .selectAll('text').attr('font-size', tickFontSize);
            
            g.append('g').select('.domain').remove();
            
            g.append('text').attr('x', width / 2).attr('y', height + (window.innerWidth <= 480 ? 35 : 40))
                .attr('fill', '#5fb3f6').attr('text-anchor', 'middle').attr('font-size', axisFontSize)
                .attr('font-weight', '600').text(xAxisLabel);

            g.append('g').call(d3.axisLeft(yScale).ticks(window.innerWidth <= 480 ? 5 : 7))
                .attr('color', 'rgba(255, 255, 255, 0.6)')
                .selectAll('text').attr('font-size', tickFontSize);
            
            g.append('text').attr('transform', 'rotate(-90)').attr('x', -height / 2)
                .attr('y', -(window.innerWidth <= 480 ? 38 : 45))
                .attr('fill', '#5fb3f6').attr('text-anchor', 'middle').attr('font-size', axisFontSize)
                .attr('font-weight', '600').text('Exam Score');

            g.insert('rect', ':first-child')
                .attr('x', -margin.left - 15).attr('y', -margin.top - 15)
                .attr('width', plotWidth + 30).attr('height', plotHeight + 30)
                .attr('fill', 'rgb(10, 20, 40)').attr('stroke', 'rgba(95, 179, 246, 0.3)')
                .attr('stroke-width', 1.5).attr('rx', 8);

            g.append('g').attr('class', 'grid').attr('opacity', 0.1)
                .call(d3.axisLeft(yScale).tickSize(-width).tickFormat(''));

            const dotRadius = window.innerWidth <= 480 ? 4 : 5;
            
            g.selectAll('.dot').data(validData).enter().append('circle').attr('class', 'dot')
                .attr('cx', d => xScale(d[variable])).attr('cy', d => yScale(d['exam_score'])).attr('r', dotRadius)
                .attr('fill', d => d['gender'] === 'Male' ? '#5fb3f6' : '#ff6b9d')
                .attr('opacity', 0.7).attr('stroke', 'white').attr('stroke-width', 1.5)
                .on('mouseover', function(e, d) {
                    d3.select(this).attr('r', dotRadius + 2).attr('opacity', 1);
                    const tooltip = d3.select('#tooltip');
                    tooltip.select('.tooltip-country').text(`${d['gender']} | ${xAxisLabel}: ${d[variable].toFixed(1)}`);
                    tooltip.select('.tooltip-score').text(`Exam Score: ${d['exam_score'].toFixed(1)}`);
                    tooltip.classed('show', true).style('left', (e.pageX + 15) + 'px').style('top', (e.pageY - 28) + 'px');
                })
                .on('mousemove', (e) => d3.select('#tooltip').style('left', (e.pageX + 15) + 'px').style('top', (e.pageY - 28) + 'px'))
                .on('mouseout', function() {
                    d3.select(this).attr('r', dotRadius).attr('opacity', 0.7);
                    d3.select('#tooltip').classed('show', false);
                });

            // Title - adjust position for mobile
            const titleY = window.innerWidth <= 480 ? centerY - height/2 - 30 : centerY + 20;
            const titleFontSize = window.innerWidth <= 480 ? '16px' : '22px';
            
            els.chart.append('text').attr('x', Config.width / 2).attr('y', titleY)
                .attr('text-anchor', 'middle').attr('fill', '#5fb3f6').attr('font-size', titleFontSize)
                .attr('font-weight', '600').text(`${xAxisLabel} vs Exam Score`);

            // Legend - adjust for mobile
            if (window.innerWidth > 480) {
                const legendX = centerX + width / 2 - 80;
                const legendY = centerY - height / 2 + 30;

                els.chart.append('rect').attr('x', legendX - 15).attr('y', legendY - 20)
                    .attr('width', 130).attr('height', 70).attr('fill', 'rgb(10, 20, 40)')
                    .attr('stroke', 'rgba(95, 179, 246, 0.3)').attr('stroke-width', 1.5).attr('rx', 8);

                els.chart.append('circle').attr('cx', legendX).attr('cy', legendY).attr('r', 5)
                    .attr('fill', '#5fb3f6').attr('opacity', 0.7);
                els.chart.append('text').attr('x', legendX + 20).attr('y', legendY + 5)
                    .attr('fill', 'rgba(255, 255, 255, 0.8)').attr('font-size', '13px').text('Male');

                els.chart.append('circle').attr('cx', legendX).attr('cy', legendY + 30).attr('r', 5)
                    .attr('fill', '#ff6b9d').attr('opacity', 0.7);
                els.chart.append('text').attr('x', legendX + 20).attr('y', legendY + 35)
                    .attr('fill', 'rgba(255, 255, 255, 0.8)').attr('font-size', '13px').text('Female');
            }
        }

        setupGlobe();
        adjustInitialScale();
        loadData();
        loadScatterData();
        setupPisaTooltip();
    </script>
</body>
</html>
